{% extends "base.html" %}

{% block title %}Task Manager - Dashboard{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="row mb-4">
    <div class="col-md-8">
        <h1 class="display-5">
            <i class="bi bi-kanban"></i> Task Dashboard
        </h1>
        <p class="lead text-muted">Manage your tasks efficiently with AI assistance and printer integration</p>
    </div>
    <div class="col-md-4 text-end">
        <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#createTaskModal">
            <i class="bi bi-plus-circle"></i> New Task
        </button>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4" id="statisticsCards">
    <!-- Statistics will be loaded here -->
</div>

<!-- Main Content Tabs -->
<div class="tab-content" id="mainTabContent">
    
    <!-- Tasks Tab -->
    <div class="tab-pane fade show active" id="tasksContent">
        
        <!-- Filters and Search -->
        <div class="row mb-3">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="searchInput" placeholder="Search tasks...">
                </div>
            </div>
            <div class="col-md-6">
                <div class="row g-2">
                    <div class="col-md-4">
                        <select class="form-select" id="statusFilter">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="in_progress">In Progress</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" id="priorityFilter">
                            <option value="">All Priorities</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" id="categoryFilter">
                            <option value="">All Categories</option>
                            <option value="personal">Personal</option>
                            <option value="work">Work</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="projectFilter">
                            <option value="">All Projects</option>
                            <!-- Projects will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="col-md-1">
                        <button class="btn btn-outline-secondary w-100" id="refreshTasksBtn">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Task Cards -->
        <div id="tasksContainer" class="row">
            <!-- Tasks will be loaded here -->
        </div>
        
        <!-- Loading Spinner -->
        <div id="tasksLoading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading tasks...</span>
            </div>
        </div>
        
        <!-- No Tasks Message -->
        <div id="noTasksMessage" class="text-center py-5 d-none">
            <div class="text-muted">
                <i class="bi bi-inbox display-1"></i>
                <h3>No tasks found</h3>
                <p>Create your first task to get started!</p>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createTaskModal">
                    <i class="bi bi-plus-circle"></i> Create Task
                </button>
            </div>
        </div>
    </div>
    
    <!-- AI Assistant Tab -->
    <div class="tab-pane fade" id="aiContent">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <div class="text-center mb-4">
                    <h2><i class="bi bi-robot"></i> AI Assistant</h2>
                    <p class="text-muted">Get intelligent suggestions for your task management</p>
                </div>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-list-ol display-4 text-primary"></i>
                                <h5 class="card-title mt-3">Prioritize Tasks</h5>
                                <p class="card-text">Get AI suggestions on task prioritization</p>
                                <button class="btn btn-primary" id="aiPrioritizeBtn">
                                    Analyze Priorities
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-lightbulb display-4 text-warning"></i>
                                <h5 class="card-title mt-3">Generate Suggestions</h5>
                                <p class="card-text">Get new task ideas based on context</p>
                                <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#aiSuggestModal">
                                    Get Suggestions
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Results Container -->
                <div id="aiResultsContainer" class="mt-4 d-none">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-cpu"></i> AI Analysis Results</h5>
                        </div>
                        <div class="card-body" id="aiResults">
                            <!-- AI results will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Printer Tab -->
    <div class="tab-pane fade" id="printerContent">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <div class="text-center mb-4">
                    <h2><i class="bi bi-printer"></i> Printer Controls</h2>
                    <p class="text-muted">Print tasks to your receipt printer</p>
                </div>
                
                <!-- Printer Status -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="bi bi-info-circle"></i> Printer Status</h5>
                    </div>
                    <div class="card-body" id="printerStatusCard">
                        <div class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Checking printer status...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Printer Actions -->
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-printer-fill display-4 text-info"></i>
                                <h5 class="card-title mt-3">Test Print</h5>
                                <p class="card-text">Test your printer connection</p>
                                <button class="btn btn-info" id="testPrintBtn">
                                    Test Print
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-list-ul display-4 text-success"></i>
                                <h5 class="card-title mt-3">Print Task List</h5>
                                <p class="card-text">Print all tasks or filtered list</p>
                                <button class="btn btn-success" id="printTaskListBtn">
                                    Print List
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Integrations Tab -->
    <div class="tab-pane fade" id="integrationsContent">
        <div class="row">
            <div class="col-md-10 mx-auto">
                <div class="text-center mb-4">
                    <h2><i class="bi bi-cloud"></i> Integrations</h2>
                    <p class="text-muted">Connect with Gmail and Google Tasks</p>
                </div>
                
                <div class="row g-4">
                    <!-- Gmail Integration -->
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header text-center bg-danger text-white">
                                <i class="bi bi-envelope display-4"></i>
                                <h5 class="mt-2">Gmail Integration</h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Import emails as tasks and send task summaries</p>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-danger" id="gmailImportBtn">
                                        <i class="bi bi-download"></i> Import from Gmail
                                    </button>
                                    <button class="btn btn-outline-danger" id="gmailSendBtn">
                                        <i class="bi bi-send"></i> Send Summary
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Google Tasks Integration -->
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header text-center bg-primary text-white">
                                <i class="bi bi-google display-4"></i>
                                <h5 class="mt-2">Google Tasks</h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Sync with your Google Tasks lists</p>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-primary" id="gtasksSyncBtn">
                                        <i class="bi bi-arrow-repeat"></i> Sync Tasks
                                    </button>
                                    <button class="btn btn-outline-primary" id="gtasksImportBtn">
                                        <i class="bi bi-download"></i> Import Only
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Integration Status -->
                <div class="mt-4">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-activity"></i> Integration Status</h5>
                        </div>
                        <div class="card-body" id="integrationStatus">
                            <div class="row text-center">
                                <div class="col-md-6">
                                    <span class="badge bg-secondary" id="gmailStatus">Gmail: Not Configured</span>
                                </div>
                                <div class="col-md-6">
                                    <span class="badge bg-secondary" id="gtasksStatus">Google Tasks: Not Configured</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- AI Suggestions Modal -->
<div class="modal fade" id="aiSuggestModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Generate Task Suggestions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="aiContext" class="form-label">Context</label>
                    <textarea class="form-control" id="aiContext" rows="3" placeholder="Describe your project or area you need help with..."></textarea>
                    <div class="form-text">Provide context about your project or goals to get relevant task suggestions.</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="generateSuggestionsBtn">
                    <i class="bi bi-lightbulb"></i> Generate Suggestions
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
        // Load initial data
        loadStatistics();
        loadTasks();
        loadProjects();
        checkPrinterStatus();
        
        // Set up tab navigation
        setupTabNavigation();
        
        // Initialize event listeners
        initializeEventListeners();
    });
</script>
{% endblock %}